<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>è‹å·å¤–å›½è¯­å­¦æ ¡-æ ¡å›­ç½‘è‡ªåŠ¨ç™»å½•å™¨</title>

	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
	<div style="position:fixed;top:0px;right:0px;-webkit-app-region:no-drag;">
		<image src="images/close.png" style="position:fixed;top:0px;right:0px;cursor:pointer;width:48px"
			onClick="hide()"></image>
	</div>
	<div class="limiter">
		<div class="container-login100" style="background-image: url('images/bg-01.jpg');">
			<div class="wrap-login100 p-l-55 p-r-55 p-t-65 p-b-54">
				<form class="login100-form validate-form">
					<span class="login100-form-title p-b-49">ç™»å½•</span>

					<div class="wrap-input100 validate-input m-b-23" data-validate="è¯·è¾“å…¥ç”¨æˆ·å">
						<span class="label-input100">ç”¨æˆ·å</span>
						<input class="input100" type="text" id="account" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="off">
						<span class="focus-input100" data-symbol="&#xf206;"></span>
					</div>

					<div class="wrap-input100 validate-input" data-validate="è¯·è¾“å…¥å¯†ç ">
						<span class="label-input100">å¯†ç </span>
						<input class="input100" type="password" name="pass" placeholder="è¯·è¾“å…¥å¯†ç ">
						<span class="focus-input100" data-symbol="&#xf190;"></span>
					</div>
					<div class="txt1 text-center p-t-54 p-b-20">
						<span>æœ¬æœºæ—¶é—´ï¼š</span><span id='localtime'></span>
						<span>ç½‘ç»œæ—¶é—´ï¼š</span><span id='settime'></span>
					</div>
					<div class="container-login100-form-btn">
						<div class="wrap-login100-form-btn">
							<div class="login100-form-bgbtn"></div>
							<button class="login100-form-btn">ç™» å½•</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<script src="js/main.js"></script>
	<script>

		var isShowWindow = true;
		var win = nw.Window.get();//è·å–çª—å£æŒ‡é’ˆ

		var tray = new nw.Tray({
			title: 'ç½‘ç»œåŠ©æ‰‹',
			icon: 'www/images/login.png',
			tooltip: "å³é”®æ‰“å¼€è‹å¤–ç½‘ç»œåŠ©æ‰‹\nMade by WilliamYan"
		});//å®šä¹‰æ‰˜ç›˜

		//æ·»åŠ èœå•--
		var menu = new nw.Menu();

		menu.append(new nw.MenuItem({
			type: 'normal',
			label: 'æ˜¾ç¤º/éšè—',
			click: function () {
				if (isShowWindow) {
					win.hide();
					isShowWindow = false;
				} else {
					win.show();
					isShowWindow = true;
				}
			}
		}));

		menu.append(new nw.MenuItem({
			type: 'normal',
			label: 'é€€å‡º',
			click: function () {
				win.close(true);
			}
		}));

		tray.menu = menu;
		//--èœå•æ·»åŠ å®Œæ¯• 20210627


		var win = nw.Window.get();//å†æ¬¡è·å–æŒ‡é’ˆ

		function addlog(log) {
			new window.Notification('æç¤º', {
				body: log
			});
		}//é€šçŸ¥ç³»ç»Ÿ


		var storage = window.localStorage;

		var loadAccount = function () {
			document.getElementById("account").value = storage.getItem("account");
			document.getElementById("password").value = storage.getItem("password");
		}

		var saveAccount = function () {
			storage.setItem("account", document.getElementById("account").value);
			storage.setItem("password", document.getElementById("password").value);
		}
		//æœ¬åœ°å­˜å‚¨



		var tryLogin = function () {
			params = {
				action: 'login',
				username: document.getElementById("account").value,
				userpwd: document.getElementById("password").value,
				ac_id: 6,
				type: 1,
				btlogin: 'ç™»å½• / Login'
			};
			var httpRequest = new XMLHttpRequest();
			httpRequest.onreadystatechange = function () {
				if (httpRequest.readyState == 4) {
					addLog("ç™»å½•è¯·æ±‚è¢«å¤„ç†");
				}
			}
			httpRequest.open('POST', 'http://10.10.10.3/cgi-bin/ace_web_auth.cgi', true);
			httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			httpRequest.send(JSON.stringify(params));
			addLog("å·²å‘èµ·ç™»å½•è¯·æ±‚");
		}

		function testNet() {
			var httpRequest = new XMLHttpRequest();
			httpRequest.onreadystatechange = function check() {
				if (httpRequest.readyState == 4) {
					if (httpRequest.status == 204) {
						addLog("ç½‘ç»œå·²è¿é€šï¼Œç™»å½•æˆåŠŸ");
					} else {
						addLog("ç½‘ç»œæœªè¿æ¥ï¼Œç™»å½•å¤±è´¥");
					}
				}
			}
			httpRequest.open('GET', storage.getItem("checkurl"), true);
			httpRequest.send(null);
			addLog("æ­£åœ¨æ£€æµ‹ç½‘ç»œè¿é€šæ€§");
		}

		var keep = false;
		var checkMode = function () {
			setTimeout(checkInterval, document.getElementById("time").value)
			addLog("æ™ºèƒ½ç»´æŒæœåŠ¡å·²ç»å¯åŠ¨");
			keep = true;
		}
		var stopChecking = function () {
			keep = false;
		}
		function checkInterval() {
			if (keep == true) {
				testAndLogin();
				setTimeout(checkInterval, 60000);
			} else {
				addLog("æ™ºèƒ½ç»´æŒæœåŠ¡å·²ç»åœæ­¢");
			}
		}
		function testAndLogin() {
			var httpRequest = new XMLHttpRequest();
			httpRequest.onreadystatechange = function check() {
				if (httpRequest.readyState == 4) {
					if (httpRequest.status == 204) {
						//addLog("ç½‘ç»œå·²è¿é€šï¼Œæ— éœ€å¤„ç†");
					} else {
						addLog("ç½‘ç»œæœªè¿æ¥ï¼Œæ­£åœ¨å‘èµ·ç™»å½•");
						tryLogin();
					}
				}
			}
			httpRequest.open('GET', storage.getItem("checkurl"), true);
			httpRequest.send(null);
			//addLog("æ­£åœ¨æ£€æµ‹ç½‘ç»œè¿é€šæ€§");
		}
		function getCurrentTime() {
			var date = new Date();//å½“å‰æ—¶é—´
			var month = zeroFill(date.getMonth() + 1);//æœˆ
			var day = zeroFill(date.getDate());//æ—¥
			var hour = zeroFill(date.getHours());//æ—¶
			var minute = zeroFill(date.getMinutes());//åˆ†
			var second = zeroFill(date.getSeconds());//ç§’

			//å½“å‰æ—¶é—´
			var curTime = hour + ":" + minute + ":" + second;

			return curTime;
		}
		function zeroFill(i) {
			if (i >= 0 && i <= 9) {
				return "0" + i;
			} else {
				return i;
			}
		}
		var win = nw.Window.get();//å†æ¬¡è·å–æŒ‡é’ˆ
		var hide = function () {
			win.hide();
			isShowWindow = false;
			addlog("ğŸ‘‡å·²æœ€å°åŒ–åˆ°æ‰˜ç›˜åŒº~")
		}
		function showLocalTime() {
			document.getElementById('localtime').innerHTML = getCurrentTime();
			setTimeout(showLocalTime, 1010);
		}
		//ä¸»ç¨‹åºæ‰§è¡Œéƒ¨åˆ†ï¼š

		showLocalTime();


		var saved = storage.getItem("account") != null;
	</script>
	<script>
		$(document).ready(function () {
			var $settime = document.getElementById('settime');
			var now = new Date();
			// è·å–æ˜ŸæœŸå‡ 
			var week = getdate(now);
			// å®ç°ä»è‹å®æ¥å£åªè·å–ä¸€æ¬¡æ—¶é—´åï¼Œæœ¬åœ°ç›´æ¥1ç§’é€’å¢æ–¹å¼æ¥æ˜¾ç¤ºæ—¶é—´
			// æ—¶é—´æ ¼å¼å¿…é¡»æ˜¯ï¼š"2020-08-18 10:09:08"
			function dateAdd(d, num) {
				var d = new Date(
					d.substring(0, 4),
					d.substring(5, 7) - 1,
					d.substring(8, 10),
					d.substring(11, 13),
					d.substring(14, 16),
					d.substring(17, 19));
				d.setTime(d.getTime() + num * 1000);
				var month = d.getMonth() + 1;
				var date = d.getDate();
				var hour = d.getHours();
				var minute = d.getMinutes();
				var second = d.getSeconds();
				var time_result = " " + todou(hour)
					+ ":" + todou(minute)
					+ ":" + todou(second);
				// æ˜¾ç¤ºåœ¨é¡µé¢
				//$settime.innerHTML =  d.getFullYear()+"å¹´"
				//  +todou(month)
				//+"æœˆ"+todou(date)+"æ—¥"
				//+time_result;
				$settime.innerHTML = time_result;
			}
			// å°äº10çš„æ•°å­—è¡¥ä½
			function todou(ev) {
				if (ev < 10) {
					ev = '0' + ev;
				}
				return ev.toString();
			}
			function getTime() {
				var userurl = 'https://quan.suning.com/getSysTime.do';
				$.ajax({
					type: 'get',
					url: userurl,
					dataType: 'json',
					success: function (data) {
						//  $settime.innerHTML = data.sysTime2.replace(/(\d{4}).(\d{1,2}).(\d{1,2})/g, '$1å¹´$2æœˆ$3æ—¥') + " " + toweek(week[0]);

						//  è§£å†³å»¶è¿Ÿæ–¹æ³•
						var startTime = new Date().getTime();
						// console.log(startTime);
						var count = 0;
						function fixed() {
							count++;
							var offset = new Date().getTime() - (startTime + count * 1000);
							var nextTime = 1000 - offset;
							if (nextTime < 0) nextTime = 0;
							setTimeout(fixed, nextTime);
							dateAdd(data.sysTime2, count);
							// console.log(new Date().getTime() - (startTime + count * 1000));
						}
						setTimeout(fixed, 1000);
						// ä»¥ä¸‹æ–¹æ³•æœ‰å»¶è¿Ÿ
						//  var i = 0;
						//  updateNum();
						//  setInterval(updateNum, 1000);
						// function updateNum()
						//  {
						//      dateAdd(data.sysTime2,++i);
						//  }
					}
				});
			}
			getTime();
			// beginbTn.onclick = function () {
			//     nowtime();
			//     var timer = setInterval(nowtime, 1000);
			//     bTn.onclick = function () {
			//         clearInterval(timer);
			//     };
			// };
			function getdate(ev) {
				var week = ev.getDay(); //æ˜ŸæœŸï¼ˆå€¼0-6ï¼‰
				return [week];
			}
		});
	</script>

</body>

</html>